@page "/"
@rendermode InteractiveServer
@using RecipeSearchWeb.Services
@using RecipeSearchWeb.Models
@inject ScriptSearchService ScriptService
@inject KnowledgeSearchService KnowledgeService
@inject NavigationManager Navigation

<PageTitle>Operations One - Control Centre</PageTitle>

<div class="md-page">
    @* Hero Section - Material Design 3 *@
    <div class="md-hero">
        <span class="md-hero-badge">
            <span class="material-symbols-outlined" style="font-size: 16px;">verified</span>
            OPERATIONS TEAM
        </span>
        <h1 class="md-hero-title">
            <span class="accent">Operations</span> One
        </h1>
        <p class="md-hero-subtitle">Unified Control Centre for IT Operations</p>
        <p class="md-hero-description">Grupo Antolin • Automation & Technical Support</p>
        
        <div class="md-hero-stats">
            <div class="md-hero-stat">
                <span class="md-hero-stat-value">@totalScripts</span>
                <span class="md-hero-stat-label">Scripts</span>
            </div>
            <div class="md-hero-stat">
                <span class="md-hero-stat-value">@totalDocs</span>
                <span class="md-hero-stat-label">Documents</span>
            </div>
        </div>
        
        <div class="md-hero-credits">
            Built with <strong>GitHub Copilot</strong> using <strong>Claude Sonnet 4</strong> & <strong>Claude Opus 4</strong>
        </div>
    </div>

    @* Quick Access Section *@
    <div class="md-section-header">
        <h2 class="md-section-title">
            <span class="material-symbols-outlined">rocket_launch</span>
            Quick Access
        </h2>
        <p class="md-section-subtitle">Jump to the tools you need</p>
    </div>

    <div class="md-card-grid md-card-grid-3">
        <div class="md-card md-card-clickable md-card-primary" @onclick='() => NavigateTo("/scripts")'>
            <div class="md-card-icon">
                <span class="material-symbols-outlined">terminal</span>
            </div>
            <h3 class="md-card-title">PowerShell Scripts</h3>
            <p class="md-card-subtitle">Browse and search the script library</p>
            <span class="md-card-action">
                Open Library
                <span class="material-symbols-outlined" style="font-size: 18px;">arrow_forward</span>
            </span>
        </div>

        <div class="md-card md-card-clickable" @onclick='() => NavigateTo("/knowledge")'>
            <div class="md-card-icon" style="background: #E6F4EA; color: #1E8E3E;">
                <span class="material-symbols-outlined">menu_book</span>
            </div>
            <h3 class="md-card-title">Knowledge Base</h3>
            <p class="md-card-subtitle">Documentation & procedures</p>
            <span class="md-card-action">
                Browse Docs
                <span class="material-symbols-outlined" style="font-size: 18px;">arrow_forward</span>
            </span>
        </div>

        <div class="md-card md-card-clickable" @onclick='() => NavigateTo("/monitoring")'>
            <div class="md-card-icon" style="background: #E8F5E9; color: #43A047;">
                <span class="material-symbols-outlined">monitoring</span>
            </div>
            <h3 class="md-card-title">Monitoring</h3>
            <p class="md-card-subtitle">Jira tickets & metrics</p>
            <span class="md-card-action">
                View Dashboard
                <span class="material-symbols-outlined" style="font-size: 18px;">arrow_forward</span>
            </span>
        </div>
    </div>

    @* Featured Scripts Section *@
    <div class="md-section-header">
        <h2 class="md-section-title">
            <span class="material-symbols-outlined">star</span>
            Featured Scripts
        </h2>
        <p class="md-section-subtitle">Most useful automation tools</p>
    </div>

    <div class="md-card-grid md-card-grid-4">
        @if (featuredScripts.Any())
        {
            @foreach (var script in featuredScripts.Take(4))
            {
                <div class="md-card md-card-clickable" @onclick="() => ShowScriptDetails(script)">
                    <div class="md-tag-primary" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem;">
                        <span>@script.CategoryEmoji</span>
                        @script.Category
                    </div>
                    <h4 class="md-card-title" style="margin-top: 12px;">@script.Name</h4>
                    <p class="md-card-subtitle" style="margin-bottom: 12px;">
                        @(script.Description.Length > 80 ? script.Description.Substring(0, 80) + "..." : script.Description)
                    </p>
                    <span class="md-complexity @script.Complexity.ToLower()">@script.Complexity</span>
                </div>
            }
        }
        else
        {
            <div class="md-loading">
                <div class="md-spinner"></div>
                <span class="md-loading-text">Loading scripts...</span>
            </div>
        }
    </div>

    @* Quick Actions & System Info *@
    <div class="md-two-col">
        <div class="md-card">
            <div class="md-section-header" style="margin-bottom: 16px;">
                <h3 class="md-section-title">
                    <span class="material-symbols-outlined">flash_on</span>
                    Quick Actions
                </h3>
            </div>
            <div class="md-actions-grid">
                <button class="md-action-btn" @onclick='() => NavigateTo("/scripts")'>
                    <span class="material-symbols-outlined icon">search</span>
                    Search Scripts
                </button>
                <button class="md-action-btn" @onclick='() => NavigateTo("/knowledge")'>
                    <span class="material-symbols-outlined icon">auto_stories</span>
                    Browse Documentation
                </button>
                <button class="md-action-btn" @onclick='() => NavigateTo("/editor")'>
                    <span class="material-symbols-outlined icon">edit_note</span>
                    Create New Script
                </button>
            </div>
        </div>

        <div class="md-card">
            <div class="md-section-header" style="margin-bottom: 16px;">
                <h3 class="md-section-title">
                    <span class="material-symbols-outlined">info</span>
                    System Info
                </h3>
            </div>
            <div class="md-info-grid">
                <div class="md-info-item">
                    <span class="md-info-label">Status</span>
                    <span class="md-info-value online">● Online</span>
                </div>
                <div class="md-info-item">
                    <span class="md-info-label">Last Update</span>
                    <span class="md-info-value">@DateTime.Now.ToString("MMM dd, yyyy")</span>
                </div>
                <div class="md-info-item">
                    <span class="md-info-label">Version</span>
                    <span class="md-info-value">2.0.0</span>
                </div>
                <div class="md-info-item">
                    <span class="md-info-label">Environment</span>
                    <span class="md-info-value">Production</span>
                </div>
            </div>
        </div>
    </div>
</div>

@* Script Details Modal - Material Design 3 *@
@if (selectedScript != null)
{
    <div class="md-modal-backdrop" @onclick="CloseModal">
        <div class="md-modal" @onclick:stopPropagation="true">
            <div class="md-modal-header">
                <div>
                    <div class="md-tag-primary" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem; margin-bottom: 8px;">
                        <span>@selectedScript.CategoryEmoji</span>
                        @selectedScript.Category
                    </div>
                    <h2 class="md-modal-title">@selectedScript.Name</h2>
                </div>
                <button class="md-modal-close" @onclick="CloseModal">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            
            <div class="md-modal-body">
                <div class="md-form-group">
                    <label class="md-form-label">
                        <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">description</span>
                        Description
                    </label>
                    <p style="color: #5F6368; margin: 0;">@selectedScript.Description</p>
                </div>
                
                <div class="md-info-grid" style="margin-bottom: 24px;">
                    <div class="md-info-item">
                        <span class="md-info-label">Complexity</span>
                        <span class="md-complexity @selectedScript.Complexity.ToLower()">@selectedScript.Complexity</span>
                    </div>
                    <div class="md-info-item">
                        <span class="md-info-label">Purpose</span>
                        <span class="md-info-value">@selectedScript.Purpose</span>
                    </div>
                </div>
                
                <div class="md-form-group">
                    <label class="md-form-label">
                        <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">code</span>
                        PowerShell Code
                    </label>
                    <div class="md-code-block">@selectedScript.Code</div>
                </div>
            </div>
            
            <div class="md-modal-actions">
                <button class="md-btn-text" @onclick="CloseModal">Close</button>
                <button class="md-btn-filled" @onclick="CopyCode">
                    <span class="material-symbols-outlined" style="font-size: 18px;">content_copy</span>
                    Copy to Clipboard
                </button>
            </div>
        </div>
    </div>
}

@code {
    private List<Script> featuredScripts = new();
    private Script? selectedScript;
    private int totalScripts = 0;
    private int totalDocs = 0;

    protected override async Task OnInitializedAsync()
    {
        var allScripts = await ScriptService.SearchScriptsAsync("", 100);
        featuredScripts = allScripts.Take(4).ToList();
        totalScripts = allScripts.Count;
        
        // Get real document count from Knowledge Base
        var allDocs = KnowledgeService.GetAllArticles();
        totalDocs = allDocs.Count;
    }

    private void NavigateTo(string url)
    {
        Navigation.NavigateTo(url);
    }

    private void ShowScriptDetails(Script script)
    {
        selectedScript = script;
    }

    private void CloseModal()
    {
        selectedScript = null;
    }

    private async Task CopyCode()
    {
        await Task.CompletedTask;
    }
}
